---
sidebar_position: 1
---

import pyramid from "./img/pyramid.png";
import anti from "./img/anti.png";

# 組み込みソフトウェア開発の現状

私はとあるメーカーで組み込みソフトウェア開発をしています。それほど経験が豊富なわけではありませんが、私が経験したプロジェクトのソフトウェア開発プロセスは非常に遅れていました。テストコードは一切なく、テストはすべて手動で実行され、デグレが頻繁に発生し、リリースが遅れることはもはや普通のことでした。

なぜテストの自動化を行わないのか？と上司や同僚に尋ねたところ、こんな答えが返ってきました。

- 「組み込みは実際にモノを動かさないとわからないからできないでしょ」
- 「テストコードとかってウェブ系の話だよね?」
- 「組み込みソフトは組み込みデバイス上で動くからそれをエミュレートするのは大変だよ」
- 「テストコードってなに?」

総じてテストの自動化なんて無理だよね。結局今のやり方しかないんだよ、という感じです。

言っていることはわかります。ウェブアプリ開発ならブラウザという統一的な環境でSeleniumやplaywriteのような優れたオープンソースのツールがありますが、企業やプロジェクトごとに異なる無数の組み込みデバイスの一つをエミュレートするためのソフトを作るのはコストが釣り合わないでしょう（医療や宇宙開発分野のような一つのバグが致命的な損害につながるところなら必要かもしれません）。

しかしそれはマニュアルテスト(E2Eテスト)に限った話です。単体テストや統合テストが難しい理由にはなりません。テストに関する知識、経験が不足したチームでは、テストの自動化というとマニュアルテストの自動化を思い浮かべてしまうようです（キャプチャ&リプレイツールの導入に興味を持つあまりテストに詳しくない人のように）。

<img src={pyramid} alt="テストピラミッド" width="300" /> [^1]

組み込みソフトウェアもロジックの集合なため、単体テストは可能なはずです。実際、手動テストや市場で見つかるバグのほとんどは分岐処理における条件ミスといったロジックに起因するものでした。これらは明らかに手動テストで発見すべき問題ではありません。

つまり、私の職場はすべてのバグを開発工程の終盤にマニュアルテストで発見しようとしていたのです。これでは評価に時間がかかってしまうのは当然です。テストピラミッドでいうとアンチパターンとして知られている"アイスクリームコーン型"よりもさらにひどい状態だったのです（単体テストが一切ないのでコーンもない）。

<img src={anti} alt="アンチパターン" width="300" /> [^1]

こんな状態から脱却し、マニュアルテストにかかる工数の削減とバグの早期発見による品質向上を達成するため私は組み込みソフトウェア開発にも単体テスト導入が必要なことをチームに説明しました。説明を受けたメンバーの反応はまちまちです。

- あんまりテストについてピンときていない
- なんかすごそうだけど実践方法がわからない
- 今のプロジェクトが忙しいから新しいこと覚えてる暇がない

なのでこのチームにテストを根付かせる活動はまだ道半ばです。私のかかわっている製品ではもちろん単体テストを導入し、CIを回せています。その結果を紹介するなどして今後もテストに興味を持ってもらえるように続けていく予定です。

本ガイドは私がチームに単体テストを導入する方法を説明した資料を一部修正したものになります。テストの重要性はわかるけど組み込みで単体テストを導入する方法がわからない、という人にとって参考になるとうれしいです。

[^1]: [Software Engineering at Google 11章 Testing Overview](https://abseil.io/resources/swe-book/html/ch11.html)
