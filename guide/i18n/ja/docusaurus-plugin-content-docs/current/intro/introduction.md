---
sidebar_position: 1
---

import pyramid from "./img/pyramid.png";
import anti from "./img/anti.png";

# 組み込みソフトウェア開発の現状

私はとあるメーカーで組み込みソフトウェア開発をしています。それほど経験が豊富なわけではありませんが、私が経験したプロジェクトのソフトウェア開発プロセスは非常に遅れていました。テストコードは一切なく、テストはすべて手動で実行され、デグレが頻繁に発生し、リリースが遅れることはもはや日常茶飯事でした。

なぜテストの自動化を行わないのか？と上司や同僚に尋ねたところ、こんな答えが返ってきました。

- 「組み込みは実際にデバイスを動かさないとわからないからできないでしょ」
- 「テストコードとかってウェブ系の話だよね?」
- 「組み込みソフトは組み込みデバイス上で動くからそれをエミュレートするのは大変だよ」
- 「テストコードってなに?」

総じてテストの自動化なんて無理だよね。結局、今のやり方を続けるしかないんだよ、という感じです。

言っていることはわかります。ウェブアプリ開発ならブラウザという統一的な環境でSeleniumやplaywriteのような優れたオープンソースのツールがありますが、企業やプロジェクトごとに異なる無数の組み込みデバイスの一つをエミュレートするためのソフトを作るのはコストが釣り合わないでしょう（医療や宇宙開発分野のような一つのバグが致命的な損害につながるところなら必要だと思います）。

しかしそれはマニュアルテスト(E2Eテスト)に限った話です。単体テストや統合テストが難しい理由にはなりません。私には、組み込みであることを言い訳に、自動化は無理だと早合点し、ソフトウェアテストに関する十分な知識を得ようともせずに、現状の方法に固執しているように感じられました。

## テストの種類

私の職場では、単体テストというものは一切存在せず、行われているのはシステムテストだけでした。すべてのテストが手動で行われ、バグの発見は開発の最終段階に集中しています。このような状況では、テスト自動化の提案をしても、当然のことながらシステムテストの自動化しか思い浮かべられません。たとえば、ウェブ業界では（テストに詳しくない人々がによって）キャプチャ&リプレイツールの導入が検討されることが多いですが、こうしたツールは手動テストの置き換えに過ぎず、テストの本質的な効率化や品質向上には直結しません。

<img src={pyramid} alt="テストピラミッド" width="300" /> [^1]

組み込みソフトウェアもロジックの集合体である以上、単体テストで十分にバグを発見できるはずです。実際、手動テストや市場で見つかるバグのほとんどは分岐処理における条件ミスといったロジックに起因するものでした。これらは明らかに手動テストで発見すべき問題ではありません。

つまり、私の職場はすべてのバグを開発工程の終盤にマニュアルテストで発見しようとしていたのです。これでは評価に時間がかかってしまうのは当然です。テストピラミッドでいうとアンチパターンとして知られている「アイスクリームコーン型」よりもさらにひどい状態であり、（単体テストが一切ないのでコーンもない）。ピラミッドの基盤すらない状態だったのです。

<img src={anti} alt="アンチパターン" width="300" /> [^1]

このような非効率なテストの構成を見直し、マニュアルテストにかかる工数の削減とバグの早期発見による品質向上を達成するため私は組み込みソフトウェア開発にも単体テスト導入が必要なことをチームに伝えました。

## チームの反応

説明を受けたメンバーの反応はまちまちでした。

- あんまりテストについてピンときていない
- なんかすごそうだけど実践方法がわからない
- 今のプロジェクトが忙しいから新しいこと覚えてる暇がない

単体テストに興味を持ち、導入し始めてくれているメンバーもいます。実際、私が担当している製品に単体テストとCIを導入したことで、バグの発見がリリース前のシステムテストフェーズから実装フェーズに早期化されました。カバレッジレポートにより分岐を網羅できているかどうかの確認が容易になり、テストの品質を定量化できるようになりました。この成果を紹介したことで、他のメンバーからも少しずつ関心を持たれ始めています。

とはいえ、組み込みソフト開発チームにテストを根付かせる活動はまだ道半ばです。単体テスト導入の効果を引き続き紹介し、今後もテストの重要性を広める活動を続けていく予定です。

本ガイドは、私がチームに単体テストを導入する方法を説明した資料を一部修正したものになります。テストの重要性はわかるけど組み込みで単体テストを導入する方法がわからない、という方にとって参考になれば嬉しいです。

[^1]: [Software Engineering at Google 11章 Testing Overview](https://abseil.io/resources/swe-book/html/ch11.html)
