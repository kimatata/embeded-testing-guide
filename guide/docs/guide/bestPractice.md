---
sidebar_position: 4
---

# ベストプラクティス

## プライベートな関数をテストする方法

プライベートな関数は一切テストしないのが原則。パブリックな関数のみテストする。
もしプライベートな関数もテストしたいと思うなら、パブリックな関数が密結合だったり、外部から振る舞いが見えにくい構成になっている可能性が高い。
構成を考え直したほうがいい。

## TDDは必須か?

必ずしもTDDで進める必要はないと思うが、実装→テストコードよりもテストコード→実装の順のほうが関数を呼び出しやすい形式に保てる。
その結果テスト可能なインターフェースをつくりやすくなる。

## テストカバレッジ

カバレッジは高いほうがもちろんいいが、100%を目指す必要はない。

カバレッジはプロダクトコードの内、テストで通過した行数からを計算しているだけ。

### カバレッジの例

以下のテストコードはif分の片方しか検証していない。

```c title="テストコード"
TEST(getAbsSuite, 絶対値を計算できる) {
  int x = 3;
  int y = -2;
  EXPECT_EQ(5, getAbs(x, y));
}
```

```c title="プロダクトコード"
int getAbs(int x, int y) {
  if (x >= y) {
    return (x - y);
  } else {
    return (y - x);
  }
}
```

3項演算子を使うだけでカバレッジは上がる。

```c title="プロダクトコード"
int getAbs(int x, int y) {
  return (x - y) >= 0 ? (x - y) : (y-x);
}
```

また、期待値チェックをしていなくてもカバレッジは上がる

```c title="テストコード"
TEST(getAbsSuite, 絶対値を計算できる) {
  getAbs(3, -2);
  getAbs(1, 5);
}
```

そもそもすべてのコードをテストする必要はない。バグが発生しやすいロジックが入り組んだ部分にだけ適用するところから初めてみるのがいい。
