---
sidebar_position: 4
---

# ベストプラクティス

## プライベートな関数をテストする方法

パブリックな関数のみ直接呼び出してテストするのが原則です。プライベートな関数はパブリックな関数内部で呼び出すことで間接的にテストします。プライベートな関数をテストのためだけにパブリックにしたり小細工するのはアンチパターンです。

もしプライベートな関数を直接呼び出してテストしたいと思うなら、パブリックな関数が密結合だったり、外部から振る舞いが見えにくい構成になっている可能性が高いので構成を考え直したほうがよいです。

## TDDは必須?

必ずしもTDDで進める必要はないと思いますが、実装→テストコードよりもテストコード→実装の順のほうがテスト可能なインターフェースを保ちやすいかもしれません

## テストカバレッジ

カバレッジは高いほうがもちろんいいが、100%を目指す必要はありません。カバレッジはプロダクトコードの内、テストで通過した行数を計算しただけのメトリクスです。

### ステートメントカバレッジ

以下のテストコードはif文の片方しか検証していません。

```c title="テストコード"
TEST(getAbsSuite, 絶対値を計算できる) {
    int x = 3;
    int y = -2;
    EXPECT_EQ(5, getAbs(x, y));
}
```

```c title="プロダクトコード"
int getAbs(int x, int y) {
    if (x >= y) {
      return (x - y);
    } else {
      return (y - x);
    }
}
```

if文を3項演算子に変えただけでカバレッジが上がります。しかし、検証できることはif文の時と同じです。

```c title="プロダクトコード"
int getAbs(int x, int y) {
    return (x - y) >= 0 ? (x - y) : (y-x);
}
```

### ブランチカバレッジ

また、期待値チェックをしていなくてもカバレッジは上がります。

```c title="テストコード"
TEST(getAbsSuite, 絶対値を計算できる) {
    getAbs(3, -2);
    getAbs(1, 5);
}
```

そもそもすべてのコードをテストする必要はありません。バグが発生しやすいロジックが入り組んだ部分に適用するところから初めてみるのがよいかもしれません。
