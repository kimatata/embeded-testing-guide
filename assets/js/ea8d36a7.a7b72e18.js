"use strict";(self.webpackChunkguide=self.webpackChunkguide||[]).push([[874],{5686:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>d,frontMatter:()=>s,metadata:()=>l,toc:()=>u});var i=n(4848),o=n(8453);const s={sidebar_position:5},r="Replacing with Function Pointers",l={id:"guide/methods/functional-pointer",title:"Replacing with Function Pointers",description:'There are cases where you want to alternate between product code and test doubles on a per-test-case basis within a single test suite executable. In such cases, you can use "replacing with function pointers."',source:"@site/docs/guide/methods/functional-pointer.md",sourceDirName:"guide/methods",slug:"/guide/methods/functional-pointer",permalink:"/embeded-testing-guide/docs/guide/methods/functional-pointer",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/guide/methods/functional-pointer.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Replacing with the Linker",permalink:"/embeded-testing-guide/docs/guide/methods/link"},next:{title:"Replacing with Mocks",permalink:"/embeded-testing-guide/docs/guide/methods/mock"}},c={},u=[{value:"How to Switch with Function Pointers",id:"how-to-switch-with-function-pointers",level:2}];function a(e){const t={admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"replacing-with-function-pointers",children:"Replacing with Function Pointers"})}),"\n",(0,i.jsx)(t.p,{children:'There are cases where you want to alternate between product code and test doubles on a per-test-case basis within a single test suite executable. In such cases, you can use "replacing with function pointers."'}),"\n",(0,i.jsx)(t.admonition,{type:"caution",children:(0,i.jsx)(t.p,{children:'Since this method can make the code harder to read, use "replacing with the linker" when you don\'t need to switch between product code and test doubles.'})}),"\n",(0,i.jsx)(t.h2,{id:"how-to-switch-with-function-pointers",children:"How to Switch with Function Pointers"}),"\n",(0,i.jsx)(t.p,{children:"Consider the following function for registering a file write queue to USB drive:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-c",metastring:'title="original function declaration"',children:"void FileCtrl_EnQueue(ST_QUEUE_ELEMENT* el)\n"})}),"\n",(0,i.jsxs)(t.p,{children:["To alternate between the product code ",(0,i.jsx)(t.code,{children:"FileCtrl_EnQueue_Real"})," and the test double ",(0,i.jsx)(t.code,{children:"FileCtrl_EnQueue_Mock"}),", change the function declaration to a function pointer declaration."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-c",metastring:'title="function declaration using function pointer"',children:"extern void (*FileCtrl_EnQueue)(ST_QUEUE_ELEMENT* el);\n"})}),"\n",(0,i.jsxs)(t.p,{children:["By assigning the function pointer ",(0,i.jsx)(t.code,{children:"FileCtrl_EnQueue_Real"})," of the product code to ",(0,i.jsx)(t.code,{children:"FileCtrl_EnQueue"}),", calls to ",(0,i.jsx)(t.code,{children:"FileCtrl_EnQueue()"})," are routed to ",(0,i.jsx)(t.code,{children:"FileCtrl_EnQueue_Real()"}),"."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-c",metastring:'title="Product Code FileManager.c"',children:"void FileCtrl_EnQueue_Real(ST_QUEUE_ELEMENT* el) {\n    // Processing that runs on the actual microcontroller\n}\nvoid (*FileCtrl_EnQueue)(ST_QUEUE_ELEMENT* el) = FileCtrl_EnQueue_Real;\n"})}),"\n",(0,i.jsxs)(t.p,{children:["In test cases where you want to use the test double ",(0,i.jsx)(t.code,{children:"FileCtrl_EnQueue_Mock"}),", assign the function pointer ",(0,i.jsx)(t.code,{children:"FileCtrl_EnQueue_Mock"})," to ",(0,i.jsx)(t.code,{children:"FileCtrl_EnQueue"}),". After the test case finishes, restore the original reference so that only that test case uses ",(0,i.jsx)(t.code,{children:"FileCtrl_EnQueue_Mock"}),"."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-c",metastring:'title="Test Code test case using real"',children:"void FileCtrl_EnQueue_Mock(ST_QUEUE_ELEMENT* el) {\n    // Test double processing\n}\n\nTEST_F(TestLogSave, TestCaseUsingFileCtrl_EnQueue) {\n\nvoid (*FileCtrl_EnQueue_Saved)(ST_QUEUE_ELEMENT* el);\n    // Pre-test setup\n    FileCtrl_EnQueue_Saved = FileCtrl_EnQueue;\n    FileCtrl_EnQueue = FileCtrl_EnQueue_Mock;\n\n    // Perform assertions using FileCtrl_EnQueue_Mock\n    // ..\n\n    // Post-test cleanup\n    FileCtrl_EnQueue = FileCtrl_EnQueue_Saved;\n}\n"})}),"\n",(0,i.jsxs)(t.admonition,{title:"Tips for GoogleTest",type:"info",children:[(0,i.jsxs)(t.p,{children:["When you want to use ",(0,i.jsx)(t.code,{children:"FileCtrl_EnQueue_Mock"})," throughout a test file in GoogleTest, defining ",(0,i.jsx)(t.code,{children:"SetUp()"})," like below will eliminate the need to assign the pointer in each test case. This makes the tests easier to read."]}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-c",metastring:'title="Test Code tetst class"',children:"class TestLogSave: public ::testing::Test {\n  protected:\n    void (*FileCtrl_EnQueue_Saved)(ST_QUEUE_ELEMENT* el);\n\n    void SetUp() override {\n        // Use mock (FileCtrl_EnQueue_Mock) for FileCtrl_EnQueue\n        FileCtrl_EnQueue_Saved = FileCtrl_EnQueue;\n        FileCtrl_EnQueue = FileCtrl_EnQueue_Mock;\n    }\n\n    void TearDown() override {\n        // Restore FileCtrl_EnQueue to reference the product code (FileCtrl_EnQueue_Real)\n        FileCtrl_EnQueue = FileCtrl_EnQueue_Saved;\n    }\n};\n"})}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-c",metastring:'title="Test Code test case using mock"',children:"TEST_F(TestLogSave, TestCaseUsingFileCtrl_EnQueue) {\n  // ..\n}\n"})})]})]})}function d(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>l});var i=n(6540);const o={},s=i.createContext(o);function r(e){const t=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);